<!DOCTYPE html>

<html dir="rtl" lang="ar">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title> Ù…ØªØ§Ø¨Ø¹Ø© Ø£Ø¹Ø·Ø§Ù„ Ø§Ù„Ø³ÙŠØ±ÙØ±Ø§Øª ÙˆØ§Ù„Ø£Ø¯ÙˆØ§Øª</title>
<style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .sync-status {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 0.9rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sync-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .sync-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #2ecc71;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .sharing-notice {
            background: #e8f4fd;
            border: 2px solid #3498db;
            border-radius: 8px;
            padding: 20px;
            margin: 20px;
            text-align: center;
        }

        .sharing-notice h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .sharing-notice p {
            color: #34495e;
            margin-bottom: 15px;
        }

        .form-section {
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 3px solid #e9ecef;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: bold;
            margin-bottom: 8px;
            color: #2c3e50;
            font-size: 1rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .priority-high { background-color: #ffebee !important; border-color: #f44336 !important; color: #c62828 !important; }
        .priority-medium { background-color: #fff3e0 !important; border-color: #ff9800 !important; color: #ef6c00 !important; }
        .priority-low { background-color: #e8f5e8 !important; border-color: #4caf50 !important; color: #2e7d32 !important; }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin: 5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #2980b9, #1f618d);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .btn-export {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
        }

        .btn-export:hover {
            background: linear-gradient(135deg, #229954, #27ae60);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #8e44ad, #9b59b6);
            color: white;
        }
         .btn-secondary:hover {
            background: linear-gradient(135deg, #7b3a9a, #8e44ad);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(142, 68, 173, 0.4);
        }


        .btn-warning {
            background: linear-gradient(135deg, #e67e22, #f39c12);
            color: white;
        }
        .btn-warning:hover {
            background: linear-gradient(135deg, #d35400, #e67e22);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(230, 126, 34, 0.4);
        }

        .table-section {
            padding: 30px;
            overflow-x: auto;
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .search-filter {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .search-filter input,
        .search-filter select {
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 0.9rem;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .data-table th {
            background: linear-gradient(135deg, #34495e, #2c3e50);
            color: white;
            padding: 15px 12px;
            text-align: center;
            font-weight: bold;
            font-size: 0.9rem;
            white-space: nowrap;
        }

        .data-table td {
            padding: 12px;
            border-bottom: 1px solid #e9ecef;
            text-align: center;
            font-size: 0.85rem;
            max-width: 150px; /* Adjust as needed */
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .data-table td:nth-child(12), /* Description */
        .data-table td:nth-child(13) { /* Solution */
            white-space: normal; /* Allow wrapping for longer text */
            min-width: 200px;
        }


        .data-table tr:hover {
            background-color: #f8f9fa;
            /* transform: scale(1.01); remove row scale for better usability with wrapped text */
            transition: background-color 0.2s ease;
        }
        
        .priority-high-cell { background-color: #ffebee; color: #c62828; }
        .priority-medium-cell { background-color: #fff3e0; color: #ef6c00; }
        .priority-low-cell { background-color: #e8f5e9; color: #2e7d32; }

        .status-pending { 
            background-color: #fff3cd; 
            color: #856404; 
            padding: 4px 8px; 
            border-radius: 4px; 
            font-weight: bold;
            display: inline-block;
        }

        .status-resolved { 
            background-color: #d4edda; 
            color: #155724; 
            padding: 4px 8px; 
            border-radius: 4px; 
            font-weight: bold;
            display: inline-block;
        }

        .status-in-progress { 
            background-color: #cce7ff; 
            color: #004085; 
            padding: 4px 8px; 
            border-radius: 4px; 
            font-weight: bold;
            display: inline-block;
        }

        .delete-btn, .edit-btn {
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
            margin: 2px;
        }

        .delete-btn {
            background: #e74c3c;
            color: white;
        }

        .delete-btn:hover {
            background: #c0392b;
            transform: scale(1.05);
        }

        .edit-btn {
            background: #3498db;
            color: white;
        }

        .edit-btn:hover {
            background: #2980b9;
            transform: scale(1.05);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card h3 {
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .stat-card p {
            font-size: 1rem;
            opacity: 0.9;
        }

        .no-data {
            text-align: center;
            padding: 40px;
            color: #6c757d;
            font-size: 1.2rem;
        }

        .notification {
            position: fixed;
            top: 20px;
            left: 50%; /* Center horizontally */
            transform: translateX(-50%); /* Adjust for centering */
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease, top 0.3s ease;
            min-width: 250px;
            text-align: center;
        }

        .notification.show {
            opacity: 1;
            visibility: visible;
            top: 30px; /* Slide down a bit */
        }

        .notification.success {
            background: #27ae60;
        }

        .notification.error {
            background: #e74c3c;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .search-filter {
                flex-direction: column;
                width: 100%; /* Make filter elements full width */
            }
            .search-filter input, .search-filter select, .search-filter button {
                width: 100%;
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .data-table {
                font-size: 0.75rem;
            }
            
            .data-table th,
            .data-table td {
                padding: 8px 6px;
            }
             .data-table td:nth-child(12), /* Description */
             .data-table td:nth-child(13) { /* Solution */
                min-width: 100px; /* Adjust for smaller screens */
            }


            .btn {
                padding: 12px 20px;
                font-size: 1rem;
                width: 100%; /* Make form buttons full width on small screens */
            }
            .sharing-notice div .btn { /* Keep sharing buttons side-by-side if possible */
                 width: auto;
            }
        }
    </style>
</head>
<body>
<div class="container">
<div class="header">
<h1> Ù…ØªØ§Ø¨Ø¹Ø© Ø£Ø¹Ø·Ø§Ù„ Ø§Ù„Ø³ÙŠØ±ÙØ±Ø§Øª ÙˆØ§Ù„Ø£Ø¯ÙˆØ§Øª</h1>
<p>Ù†Ø¸Ø§Ù… ØªÙˆØ«ÙŠÙ‚ Ø´Ø§Ù…Ù„ Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø£Ø¹Ø·Ø§Ù„ ÙˆØ§Ù„ØµÙŠØ§Ù†Ø§Øª</p>
<div class="sync-status">
<div class="sync-indicator">
<div class="sync-dot"></div>
<span>Ù†Ø´Ø·</span>
</div>
</div>
</div>

<div class="form-section">
<h2 style="color: #2c3e50; margin-bottom: 20px; font-size: 1.5rem;">ğŸ“ Ø¥Ø¶Ø§ÙØ©/ØªØ¹Ø¯ÙŠÙ„ Ø­Ø¯Ø«</h2>
<form id="issueForm">
<div class="form-grid">
<div class="form-group">
<label for="region">Ø§Ù„Ù…Ù†Ø·Ù‚Ø© *</label>
<select id="region" required="">
<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</option>
<option value="Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©">Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©</option>
<option value="Ø§Ù„Ø¬ÙŠØ²Ø©">Ø§Ù„Ø¬ÙŠØ²Ø©</option>
<option value="Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©">Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©</option>
<option value="Ø§Ù„Ø¯Ù‚Ù‡Ù„ÙŠØ©">Ø§Ù„Ø¯Ù‚Ù‡Ù„ÙŠØ©</option>
<option value="Ø§Ù„Ø´Ø±Ù‚ÙŠØ©">Ø§Ù„Ø´Ø±Ù‚ÙŠØ©</option>
<option value="Ø§Ù„Ù‚Ù„ÙŠÙˆØ¨ÙŠØ©">Ø§Ù„Ù‚Ù„ÙŠÙˆØ¨ÙŠØ©</option>
<option value="ÙƒÙØ± Ø§Ù„Ø´ÙŠØ®">ÙƒÙØ± Ø§Ù„Ø´ÙŠØ®</option>
<option value="Ø§Ù„ØºØ±Ø¨ÙŠØ©">Ø§Ù„ØºØ±Ø¨ÙŠØ©</option>
<option value="Ø§Ù„Ù…Ù†ÙˆÙÙŠØ©">Ø§Ù„Ù…Ù†ÙˆÙÙŠØ©</option>
<option value="Ø§Ù„Ø¨Ø­ÙŠØ±Ø©">Ø§Ù„Ø¨Ø­ÙŠØ±Ø©</option>
<option value="Ø§Ù„Ø¥Ø³Ù…Ø§Ø¹ÙŠÙ„ÙŠØ©">Ø§Ù„Ø¥Ø³Ù…Ø§Ø¹ÙŠÙ„ÙŠØ©</option>
<option value="Ø¨ÙˆØ±Ø³Ø¹ÙŠØ¯">Ø¨ÙˆØ±Ø³Ø¹ÙŠØ¯</option>
<option value="Ø§Ù„Ø³ÙˆÙŠØ³">Ø§Ù„Ø³ÙˆÙŠØ³</option>
<option value="Ø´Ù…Ø§Ù„ Ø³ÙŠÙ†Ø§Ø¡">Ø´Ù…Ø§Ù„ Ø³ÙŠÙ†Ø§Ø¡</option>
<option value="Ø¬Ù†ÙˆØ¨ Ø³ÙŠÙ†Ø§Ø¡">Ø¬Ù†ÙˆØ¨ Ø³ÙŠÙ†Ø§Ø¡</option>
<option value="Ø§Ù„ÙÙŠÙˆÙ…">Ø§Ù„ÙÙŠÙˆÙ…</option>
<option value="Ø¨Ù†ÙŠ Ø³ÙˆÙŠÙ">Ø¨Ù†ÙŠ Ø³ÙˆÙŠÙ</option>
<option value="Ø§Ù„Ù…Ù†ÙŠØ§">Ø§Ù„Ù…Ù†ÙŠØ§</option>
<option value="Ø£Ø³ÙŠÙˆØ·">Ø£Ø³ÙŠÙˆØ·</option>
<option value="Ø³ÙˆÙ‡Ø§Ø¬">Ø³ÙˆÙ‡Ø§Ø¬</option>
<option value="Ù‚Ù†Ø§">Ù‚Ù†Ø§</option>
<option value="Ø£Ø³ÙˆØ§Ù†">Ø£Ø³ÙˆØ§Ù†</option>
<option value="Ø§Ù„Ø£Ù‚ØµØ±">Ø§Ù„Ø£Ù‚ØµØ±</option>
<option value="Ø§Ù„Ø¨Ø­Ø± Ø§Ù„Ø£Ø­Ù…Ø±">Ø§Ù„Ø¨Ø­Ø± Ø§Ù„Ø£Ø­Ù…Ø±</option>
<option value="Ø§Ù„ÙˆØ§Ø¯ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯">Ø§Ù„ÙˆØ§Ø¯ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯</option>
<option value="Ù…Ø·Ø±ÙˆØ­">Ù…Ø·Ø±ÙˆØ­</option>
</select>
</div>
<div class="form-group">
<label for="issueType">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© *</label>
<select id="issueType" required="">
<option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©</option>
<option value="Ø¹Ø·Ù„ Ø³ÙŠØ±ÙØ±">Ø¹Ø·Ù„ Ø³ÙŠØ±ÙØ±</option>
<option value="ØµÙŠØ§Ù†Ø© Ø³ÙŠØ±ÙØ±">ØµÙŠØ§Ù†Ø© Ø³ÙŠØ±ÙØ±</option>
<option value="Ø¹Ø·Ù„ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª">Ø¹Ø·Ù„ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª</option>
<option value="Ø¹Ø·Ù„ Ø£Ø¯Ø§Ø© Ø¥Ø¯Ø®Ø§Ù„">Ø¹Ø·Ù„ Ø£Ø¯Ø§Ø© Ø¥Ø¯Ø®Ø§Ù„</option>
<option value="Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø±Ø³Ù…">Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø±Ø³Ù…</option>
<option value="ØªØ­Ø¯ÙŠØ« Ø£Ø¯Ø§Ø©">ØªØ­Ø¯ÙŠØ« Ø£Ø¯Ø§Ø©</option>
<option value="Ù…Ø´ÙƒÙ„Ø© Ø´Ø¨ÙƒØ©">Ù…Ø´ÙƒÙ„Ø© Ø´Ø¨ÙƒØ©</option>
<option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
</select>
</div>
<div class="form-group">
<label for="priority">Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© *</label>
<select id="priority" required="">
<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</option>
<option value="Ø¹Ø§Ù„ÙŠØ©">Ø¹Ø§Ù„ÙŠØ©</option>
<option value="Ù…ØªÙˆØ³Ø·Ø©">Ù…ØªÙˆØ³Ø·Ø©</option>
<option value="Ù…Ù†Ø®ÙØ¶Ø©">Ù…Ù†Ø®ÙØ¶Ø©</option>
</select>
</div>
<div class="form-group">
<label for="contactPerson">Ø§Ø³Ù… Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ù…ØªÙˆØ§ØµÙ„ *</label>
<input id="contactPerson" placeholder="Ø§Ø³Ù… Ø§Ù„Ø´Ø®Øµ Ù…Ù† Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø®Ø±Ù‰" required="" type="text"/>
</div>
<div class="form-group">
<label for="reportedBy">Ø§Ù„Ù…ÙØ¨Ù„Øº Ø¹Ù† Ø§Ù„Ù…Ø´ÙƒÙ„Ø© *</label>
<input id="reportedBy" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ù…ÙØ¨Ù„Øº" required="" type="text"/>
</div>
<div class="form-group">
<label for="affectedSystem">Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªØ£Ø«Ø±</label>
<input id="affectedSystem" placeholder="Ø§Ø³Ù… Ø§Ù„Ù†Ø¸Ø§Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„Ù…ØªØ£Ø«Ø±" type="text"/>
</div>
</div>
<div class="form-grid">
<div class="form-group">
<label for="startTime">ÙˆÙ‚Øª Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ø´ÙƒÙ„Ø© *</label>
<input id="startTime" required="" type="datetime-local"/>
</div>
<div class="form-group">
<label for="endTime">ÙˆÙ‚Øª Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©</label>
<input id="endTime" type="datetime-local"/>
</div>
<div class="form-group">
<label for="status">Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø´ÙƒÙ„Ø© *</label>
<select id="status" required="">
<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø­Ø§Ù„Ø©</option>
<option value="Ù…Ø¹Ù„Ù‚Ø©">Ù…Ø¹Ù„Ù‚Ø©</option>
<option value="Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</option>
<option value="Ù…Ø­Ù„ÙˆÙ„Ø©">Ù…Ø­Ù„ÙˆÙ„Ø©</option>
</select>
</div>
<div class="form-group">
<label for="duration">Ù…Ø¯Ø© Ø§Ù„ØªØ¹Ø·ÙŠÙ„ (Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚)</label>
<input id="duration" placeholder="Ø§Ù„Ù…Ø¯Ø© Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚ (ØªØ­Ø³Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¥Ø°Ø§ Ø£Ù…ÙƒÙ†)" type="number"/>
</div>
</div>
<div class="form-group">
<label for="description">ÙˆØµÙ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© *</label>
<textarea id="description" placeholder="ÙˆØµÙ ØªÙØµÙŠÙ„ÙŠ Ù„Ù„Ù…Ø´ÙƒÙ„Ø© ÙˆØ§Ù„Ø£Ø¹Ø±Ø§Ø¶" required=""></textarea>
</div>
<div class="form-group">
<label for="solution">Ø§Ù„Ø­Ù„ Ø§Ù„Ù…Ø·Ø¨Ù‚</label>
<textarea id="solution" placeholder="ÙˆØµÙ Ø§Ù„Ø­Ù„ Ø£Ùˆ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù…ØªØ®Ø°Ø©"></textarea>
</div>
<div class="form-group">
<label for="notes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</label>
<textarea id="notes" placeholder="Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø£Ø®Ø±Ù‰ Ù…Ù‡Ù…Ø©"></textarea>
</div>
<div style="display: flex; gap: 15px; margin-top: 25px; flex-wrap: wrap;">
<button class="btn btn-primary" type="submit">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†</button>
<button class="btn btn-warning" onclick="clearAllData()" type="button">Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø©</button>

</div>
</form>
</div>
<div class="form-section">
<h2 style="color: #2c3e50; margin-bottom: 20px; font-size: 1.5rem;">ğŸ“ˆ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø©</h2>
<div class="stats" id="stats">
<div class="stat-card">
<h3 id="totalIssues">0</h3>
<p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„</p>
</div>
<div class="stat-card">
<h3 id="pendingIssues">0</h3>
<p>Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©/Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</p>
</div>
<div class="stat-card">
<h3 id="resolvedIssues">0</h3>
<p>Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ù…Ø­Ù„ÙˆÙ„Ø©</p>
</div>
<div class="stat-card">
<h3 id="avgDowntime">0</h3>
<p>Ù…ØªÙˆØ³Ø· ÙˆÙ‚Øª Ø§Ù„ØªØ¹Ø·ÙŠÙ„ (Ø¯Ù‚ÙŠÙ‚Ø©)</p>
</div>
</div>
</div>
<div class="table-section">
<div class="controls">
<h2 style="color: #2c3e50; font-size: 1.5rem;">ğŸ“‹ Ø³Ø¬Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«</h2>
<div class="search-filter">
<input id="searchInput" placeholder="Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª..." type="text"/>
<select id="filterRegion">
<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚</option>
</select>
<select id="filterStatus">
<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
<option value="Ù…Ø¹Ù„Ù‚Ø©">Ù…Ø¹Ù„Ù‚Ø©</option>
<option value="Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</option>
<option value="Ù…Ø­Ù„ÙˆÙ„Ø©">Ù…Ø­Ù„ÙˆÙ„Ø©</option>
</select>
<select id="filterPriority">
<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ§Øª</option>
<option value="Ø¹Ø§Ù„ÙŠØ©">Ø¹Ø§Ù„ÙŠØ©</option>
<option value="Ù…ØªÙˆØ³Ø·Ø©">Ù…ØªÙˆØ³Ø·Ø©</option>
<option value="Ù…Ù†Ø®ÙØ¶Ø©">Ù…Ù†Ø®ÙØ¶Ø©</option>
</select>
<button class="btn" onclick="clearFilters()" style="background: #95a5a6; color: white; padding: 10px 15px; font-size:0.9rem;">Ù…Ø³Ø­ Ø§Ù„ÙÙ„Ø§ØªØ±</button>
</div>
</div>
<div id="tableContainer">
<div class="no-data">
<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¹Ø±Ø¶. ÙŠØ±Ø¬Ù‰ Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ Ø­Ø¯Ø« Ø£Ùˆ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù„Ù.</p>
</div>
</div>
</div>
</div>
<div class="notification" id="notification"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script>
        let issuesData = [];
        let currentEditIndex = -1; // -1 for new, otherwise index of item being edited

        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            loadRegionsInFilter(); // Populate filter dropdown
            updateTable();
            updateStats();
            
            document.getElementById('startTime').value = getCurrentDateTime();
            
            document.getElementById('issueForm').addEventListener('submit', handleSubmit);
            document.getElementById('searchInput').addEventListener('input', updateTable);
            document.getElementById('filterRegion').addEventListener('change', updateTable);
            document.getElementById('filterStatus').addEventListener('change', updateTable);
            document.getElementById('filterPriority').addEventListener('change', updateTable);
            document.getElementById('priority').addEventListener('change', updatePriorityStyle);

            // Auto-calculate duration
            document.getElementById('startTime').addEventListener('change', calculateDuration);
            document.getElementById('endTime').addEventListener('change', calculateDuration);
        });

        function getCurrentDateTime() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            return `${year}-${month}-${day}T${hours}:${minutes}`;
        }

        function calculateDuration() {
            const startTimeStr = document.getElementById('startTime').value;
            const endTimeStr = document.getElementById('endTime').value;
            const durationInput = document.getElementById('duration');

            if (startTimeStr && endTimeStr) {
                const start = new Date(startTimeStr);
                const end = new Date(endTimeStr);
                if (end > start) {
                    const diffMillis = end - start;
                    durationInput.value = Math.round(diffMillis / 60000); // milliseconds to minutes
                } else {
                    durationInput.value = ''; // Or 0, or show an error
                }
            } else {
                // durationInput.value = ''; // Keep existing manual value if one time is missing
            }
        }


        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`; // Reset classes then add specific type
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function saveData() {
            try {
                const dataToSave = {
                    data: issuesData,
                    lastSaved: new Date().toISOString(),
                    version: '1.1' // Increment version if schema changes
                };
                localStorage.setItem('serverIssuesData', JSON.stringify(dataToSave));
                // No success message for every save to avoid being too chatty, 
                // unless it's a major operation like import.
            } catch (e) {
                console.error('Failed to save data to localStorage:', e);
                showNotification('ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠØ§Ù‹. Ù‚Ø¯ ØªÙƒÙˆÙ† Ù…Ø³Ø§Ø­Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ† Ù…Ù…ØªÙ„Ø¦Ø©.', 'error');
            }
        }

        function loadData() {
            try {
                const saved = localStorage.getItem('serverIssuesData');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    if (parsed.data && Array.isArray(parsed.data)) {
                        issuesData = parsed.data;
                        // showNotification('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ù…Ø­Ù„ÙŠØ§Ù‹ Ø¨Ù†Ø¬Ø§Ø­.');
                    } else {
                        issuesData = [];
                    }
                } else {
                    issuesData = [];
                }
            } catch (e) {
                console.error('Failed to load data from localStorage:', e);
                issuesData = [];
                showNotification('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©. Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ø§Ù„Ù…Ù„Ù ØªØ§Ù„ÙÙ‹Ø§ Ø£Ùˆ Ø£Ù† Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ ØºÙŠØ± ØµØ­ÙŠØ­.', 'error');
            }
        }

        function loadRegionsInFilter() {
            const staticRegionSelect = document.getElementById('region');
            const filterRegionSelect = document.getElementById('filterRegion');
            const currentFilterValue = filterRegionSelect.value; // Preserve selected filter

            while (filterRegionSelect.options.length > 1) {
                filterRegionSelect.remove(1);
            }

            const regionsFromData = [...new Set(issuesData.map(item => item.region).filter(Boolean))];
            const staticRegions = [];
            for (let i = 1; i < staticRegionSelect.options.length; i++) {
                staticRegions.push(staticRegionSelect.options[i].value);
            }

            const allUniqueRegions = [...new Set([...staticRegions, ...regionsFromData])].sort();

            allUniqueRegions.forEach(regionValue => {
                if (regionValue) {
                    const option = document.createElement('option');
                    option.value = regionValue;
                    option.textContent = regionValue;
                    filterRegionSelect.appendChild(option);
                }
            });
            filterRegionSelect.value = currentFilterValue; // Restore selection if possible
        }


        function updatePriorityStyle() {
            const prioritySelect = document.getElementById('priority');
            const priority = prioritySelect.value;
            
            prioritySelect.className = 'form-group select'; // Reset base class
            if (priority === 'Ø¹Ø§Ù„ÙŠØ©') {
                prioritySelect.classList.add('priority-high');
            } else if (priority === 'Ù…ØªÙˆØ³Ø·Ø©') {
                prioritySelect.classList.add('priority-medium');
            } else if (priority === 'Ù…Ù†Ø®ÙØ¶Ø©') {
                prioritySelect.classList.add('priority-low');
            }
        }

        function handleSubmit(e) {
            e.preventDefault();
            calculateDuration(); // Ensure duration is up-to-date before saving

            const formData = {
                id: currentEditIndex >= 0 ? issuesData[currentEditIndex].id : Date.now() + Math.random().toString(36).substr(2, 9), // More unique ID
                region: document.getElementById('region').value,
                issueType: document.getElementById('issueType').value,
                priority: document.getElementById('priority').value,
                contactPerson: document.getElementById('contactPerson').value,
                reportedBy: document.getElementById('reportedBy').value,
                affectedSystem: document.getElementById('affectedSystem').value,
                startTime: document.getElementById('startTime').value,
                endTime: document.getElementById('endTime').value,
                status: document.getElementById('status').value,
                duration: document.getElementById('duration').value,
                description: document.getElementById('description').value,
                solution: document.getElementById('solution').value,
                notes: document.getElementById('notes').value,
                lastModified: new Date().toISOString()
            };

            if (currentEditIndex >= 0) { // Editing existing item
                formData.timestamp = issuesData[currentEditIndex].timestamp || new Date(formData.id).toISOString(); // Preserve original timestamp if exists
                issuesData[currentEditIndex] = formData;
                showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù† Ø¨Ù†Ø¬Ø§Ø­');
            } else { // Adding new item
                formData.timestamp = new Date().toISOString(); // Timestamp for creation
                issuesData.unshift(formData); // Add to the beginning of the array for most recent first
                showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù† Ø¨Ù†Ø¬Ø§Ø­');
            }
            
            saveData();
            resetForm();
            updateTable();
            updateStats();
            loadRegionsInFilter(); // Update regions in filter if a new one was added
        }

        function resetForm() {
            document.getElementById('issueForm').reset();
            document.getElementById('startTime').value = getCurrentDateTime();
            document.getElementById('endTime').value = '';
            document.getElementById('duration').value = '';
            const prioritySelect = document.getElementById('priority');
            prioritySelect.className = ''; // Remove priority-specific classes
            prioritySelect.selectedIndex = 0;
            
            document.getElementById('region').selectedIndex = 0;
            document.getElementById('issueType').selectedIndex = 0;
            document.getElementById('status').selectedIndex = 0;

            currentEditIndex = -1;
            document.querySelector('#issueForm button[type="submit"]').textContent = 'Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†';
        }

        function updateTable() {
            const tableContainer = document.getElementById('tableContainer');
            const searchInput = document.getElementById('searchInput').value.toLowerCase();
            const filterRegionValue = document.getElementById('filterRegion').value;
            const filterStatusValue = document.getElementById('filterStatus').value;
            const filterPriorityValue = document.getElementById('filterPriority').value;

            const filteredData = issuesData.filter(item => {
                const matchesSearch = (
                    (item.region && item.region.toLowerCase().includes(searchInput)) ||
                    (item.issueType && item.issueType.toLowerCase().includes(searchInput)) ||
                    (item.priority && item.priority.toLowerCase().includes(searchInput)) ||
                    (item.contactPerson && item.contactPerson.toLowerCase().includes(searchInput)) ||
                    (item.reportedBy && item.reportedBy.toLowerCase().includes(searchInput)) ||
                    (item.affectedSystem && item.affectedSystem.toLowerCase().includes(searchInput)) ||
                    (item.status && item.status.toLowerCase().includes(searchInput)) ||
                    (item.description && item.description.toLowerCase().includes(searchInput)) ||
                    (item.solution && item.solution.toLowerCase().includes(searchInput)) ||
                    (item.notes && item.notes.toLowerCase().includes(searchInput))
                );
                const matchesRegion = !filterRegionValue || item.region === filterRegionValue;
                const matchesStatus = !filterStatusValue || item.status === filterStatusValue;
                const matchesPriority = !filterPriorityValue || item.priority === filterPriorityValue;
                return matchesSearch && matchesRegion && matchesStatus && matchesPriority;
            });

            if (filteredData.length === 0) {
                tableContainer.innerHTML = `<div class="no-data"><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¹Ø±Ø¶ ØªØ·Ø§Ø¨Ù‚ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¨Ø­Ø« Ø£Ùˆ Ø§Ù„ÙÙ„ØªØ±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©. Ø­Ø§ÙˆÙ„ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙÙ„Ø§ØªØ± Ø£Ùˆ Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©.</p></div>`;
                return;
            }

            tableContainer.innerHTML = createTableHTML(filteredData);
        }

        function createTableHTML(data) {
            let tableHTML = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Ù…</th>
                            <th>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</th>
                            <th>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©</th>
                            <th>Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</th>
                            <th>Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ù…ØªÙˆØ§ØµÙ„</th>
                            <th>Ø§Ù„Ù…ÙØ¨Ù„Øº</th>
                            <th>Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªØ£Ø«Ø±</th>
                            <th>ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</th>
                            <th>ÙˆÙ‚Øª Ø§Ù„Ù†Ù‡Ø§ÙŠØ©</th>
                            <th>Ø§Ù„Ù…Ø¯Ø© (Ø¯Ù‚Ø§Ø¦Ù‚)</th>
                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th>Ø§Ù„ÙˆØµÙ</th>
                            <th>Ø§Ù„Ø­Ù„</th>
                            <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                            <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            data.forEach((item, displayIndex) => {
                const originalIndex = issuesData.findIndex(d => d.id === item.id);
                tableHTML += `
                    <tr>
                        <td>${displayIndex + 1}</td>
                        <td title="${item.region || ''}">${item.region || '-'}</td>
                        <td title="${item.issueType || ''}">${item.issueType || '-'}</td>
                        <td title="${item.priority || ''}" class="${item.priority === 'Ø¹Ø§Ù„ÙŠØ©' ? 'priority-high-cell' : item.priority === 'Ù…ØªÙˆØ³Ø·Ø©' ? 'priority-medium-cell' : item.priority === 'Ù…Ù†Ø®ÙØ¶Ø©' ? 'priority-low-cell' : ''}">${item.priority || '-'}</td>
                        <td title="${item.contactPerson || ''}">${item.contactPerson || '-'}</td>
                        <td title="${item.reportedBy || ''}">${item.reportedBy || '-'}</td>
                        <td title="${item.affectedSystem || ''}">${item.affectedSystem || '-'}</td>
                        <td title="${item.startTime ? new Date(item.startTime).toLocaleString('ar-EG', {dateStyle:'short', timeStyle:'short'}) : ''}">${item.startTime ? new Date(item.startTime).toLocaleString('ar-EG', {dateStyle:'short', timeStyle:'short'}) : '-'}</td>
                        <td title="${item.endTime ? new Date(item.endTime).toLocaleString('ar-EG', {dateStyle:'short', timeStyle:'short'}) : ''}">${item.endTime ? new Date(item.endTime).toLocaleString('ar-EG', {dateStyle:'short', timeStyle:'short'}) : '-'}</td>
                        <td title="${item.duration || ''}">${item.duration || '-'}</td>
                        <td><span class="status-${item.status === 'Ù…Ø­Ù„ÙˆÙ„Ø©' ? 'resolved' : item.status === 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©' ? 'in-progress' : 'pending'}">${item.status || '-'}</span></td>
                        <td title="${item.description || ''}"><div style="max-height: 60px; overflow-y: auto;">${item.description || '-'}</div></td>
                        <td title="${item.solution || ''}"><div style="max-height: 60px; overflow-y: auto;">${item.solution || '-'}</div></td>
                        <td title="${item.notes || ''}"><div style="max-height: 60px; overflow-y: auto;">${item.notes || '-'}</div></td>
                        <td>
                            <button class="edit-btn" onclick="editIssue(${originalIndex})">ØªØ¹Ø¯ÙŠÙ„</button>
                            <button class="delete-btn" onclick="deleteIssue(${originalIndex})">Ø­Ø°Ù</button>
                        </td>
                    </tr>
                `;
            });
            tableHTML += `</tbody></table>`;
            return tableHTML;
        }
        
        function editIssue(index) {
            if (index < 0 || index >= issuesData.length) return;
            currentEditIndex = index;
            const item = issuesData[index];

            document.getElementById('region').value = item.region || '';
            document.getElementById('issueType').value = item.issueType || '';
            document.getElementById('priority').value = item.priority || '';
            updatePriorityStyle();
            document.getElementById('contactPerson').value = item.contactPerson || '';
            document.getElementById('reportedBy').value = item.reportedBy || '';
            document.getElementById('affectedSystem').value = item.affectedSystem || '';
            document.getElementById('startTime').value = item.startTime || '';
            document.getElementById('endTime').value = item.endTime || '';
            document.getElementById('status').value = item.status || '';
            document.getElementById('duration').value = item.duration || '';
            document.getElementById('description').value = item.description || '';
            document.getElementById('solution').value = item.solution || '';
            document.getElementById('notes').value = item.notes || '';

            document.querySelector('#issueForm button[type="submit"]').textContent = 'ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†';
            document.getElementById('issueForm').scrollIntoView({ behavior: 'smooth', block: 'start' });
            document.getElementById('region').focus();
        }

        function deleteIssue(index) {
            if (index < 0 || index >= issuesData.length) return;
            const itemDescription = (issuesData[index].description || "Ø¨ÙŠØ§Ù† Ø¨Ø¯ÙˆÙ† ÙˆØµÙ").substring(0, 30) + "...";
            if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¨ÙŠØ§Ù†ØŸ\n"${itemDescription}"`)) {
                issuesData.splice(index, 1);
                saveData();
                updateTable();
                updateStats();
                loadRegionsInFilter(); // In case the deleted item was the only one from a region
                showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù† Ø¨Ù†Ø¬Ø§Ø­');
            }
        }

        function updateStats() {
            document.getElementById('totalIssues').textContent = issuesData.length;
            const pending = issuesData.filter(item => item.status === 'Ù…Ø¹Ù„Ù‚Ø©' || item.status === 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©').length;
            document.getElementById('pendingIssues').textContent = pending;
            const resolved = issuesData.filter(item => item.status === 'Ù…Ø­Ù„ÙˆÙ„Ø©').length;
            document.getElementById('resolvedIssues').textContent = resolved;

            let totalDowntime = 0;
            let resolvedWithDuration = 0;
            issuesData.forEach(item => {
                if (item.status === 'Ù…Ø­Ù„ÙˆÙ„Ø©' && item.duration && !isNaN(parseFloat(item.duration))) {
                    totalDowntime += parseFloat(item.duration);
                    resolvedWithDuration++;
                }
            });
            const avgDowntime = resolvedWithDuration > 0 ? (totalDowntime / resolvedWithDuration).toFixed(0) : 0;
            document.getElementById('avgDowntime').textContent = avgDowntime;
        }
        
        function exportToJSON() {
            if (issuesData.length === 0) {
                showNotification('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„ØªØµØ¯ÙŠØ±Ù‡Ø§', 'error');
                return;
            }
            const jsonData = JSON.stringify({ data: issuesData, exportDate: new Date().toISOString(), version: '1.1' }, null, 2);
            const blob = new Blob([jsonData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            const now = new Date();
            const timestamp = `${now.getFullYear()}${(now.getMonth()+1).toString().padStart(2,'0')}${now.getDate().toString().padStart(2,'0')}_${now.getHours().toString().padStart(2,'0')}${now.getMinutes().toString().padStart(2,'0')}`;
            a.download = `issues_backup_${timestamp}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showNotification('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒÙ…Ù„Ù JSON Ø¨Ù†Ø¬Ø§Ø­');
        }

        function exportToExcel() {
            if (issuesData.length === 0) {
                showNotification('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„ØªØµØ¯ÙŠØ±Ù‡Ø§', 'error');
                return;
            }
            const dataForExcel = issuesData.map(item => ({
                "Ø§Ù„Ù…Ù†Ø·Ù‚Ø©": item.region,
                "Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©": item.issueType,
                "Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©": item.priority,
                "Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ù…ØªÙˆØ§ØµÙ„": item.contactPerson,
                "Ø§Ù„Ù…ÙØ¨Ù„Øº Ø¹Ù† Ø§Ù„Ù…Ø´ÙƒÙ„Ø©": item.reportedBy,
                "Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªØ£Ø«Ø±": item.affectedSystem || '',
                "ÙˆÙ‚Øª Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ø´ÙƒÙ„Ø©": item.startTime ? new Date(item.startTime).toLocaleString('ar-EG', {dateStyle:'medium', timeStyle:'short'}) : '',
                "ÙˆÙ‚Øª Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©": item.endTime ? new Date(item.endTime).toLocaleString('ar-EG', {dateStyle:'medium', timeStyle:'short'}) : '',
                "Ù…Ø¯Ø© Ø§Ù„ØªØ¹Ø·ÙŠÙ„ (Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚)": item.duration || '',
                "Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø´ÙƒÙ„Ø©": item.status,
                "ÙˆØµÙ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©": item.description,
                "Ø§Ù„Ø­Ù„ Ø§Ù„Ù…Ø·Ø¨Ù‚": item.solution || '',
                "Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©": item.notes || '',
                "ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„": item.timestamp ? new Date(item.timestamp).toLocaleString('ar-EG', {dateStyle:'medium', timeStyle:'short'}) : '',
                "Ø¢Ø®Ø± ØªØ¹Ø¯ÙŠÙ„": item.lastModified ? new Date(item.lastModified).toLocaleString('ar-EG', {dateStyle:'medium', timeStyle:'short'}) : ''
            }));

            const worksheet = XLSX.utils.json_to_sheet(dataForExcel);
            const columnWidths = [
                {wch:15},{wch:18},{wch:10},{wch:20},{wch:20},{wch:20}, // Ù… to Ø§Ù„Ù†Ø¸Ø§Ù…
                {wch:22},{wch:22},{wch:15},{wch:12}, // ØªÙˆØ§Ø±ÙŠØ®, Ù…Ø¯Ø©, Ø­Ø§Ù„Ø©
                {wch:40},{wch:40},{wch:30},{wch:22},{wch:22} // ÙˆØµÙ, Ø­Ù„, Ù…Ù„Ø§Ø­Ø¸Ø§Øª, ØªÙˆØ§Ø±ÙŠØ® ØªØ³Ø¬ÙŠÙ„ ÙˆØªØ¹Ø¯ÙŠÙ„
            ];
            worksheet['!cols'] = columnWidths;
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, "Ø³Ø¬Ù„ Ø§Ù„Ø£Ø¹Ø·Ø§Ù„");
            
            const now = new Date();
            const timestamp = `${now.getFullYear()}${(now.getMonth()+1).toString().padStart(2,'0')}${now.getDate().toString().padStart(2,'0')}_${now.getHours().toString().padStart(2,'0')}${now.getMinutes().toString().padStart(2,'0')}`;
            XLSX.writeFile(workbook, `issues_export_${timestamp}.xlsx`);
            showNotification('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒÙ…Ù„Ù Excel Ø¨Ù†Ø¬Ø§Ø­');
        }

        function importFromFile() {
            document.getElementById('fileInput').click();
        }
        
        function handleFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    if (file.name.endsWith('.json')) {
                        importFromJSON(e.target.result);
                    } else if (file.name.endsWith('.xlsx') || file.name.endsWith('.xls')) {
                        importFromExcel(e.target.result);
                    } else {
                        showNotification('ØµÙŠØºØ© Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… JSON Ø£Ùˆ Excel (xlsx, xls).', 'error');
                    }
                } catch (err) {
                    console.error("Error processing file:", err);
                    showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„Ù: ' + err.message, 'error');
                } finally {
                    event.target.value = null; 
                }
            };
            if (file.name.endsWith('.xlsx') || file.name.endsWith('.xls')) {
                reader.readAsArrayBuffer(file);
            } else {
                reader.readAsText(file);
            }
        }

        function importFromJSON(jsonDataString) {
            let parsedData;
            try {
                 parsedData = JSON.parse(jsonDataString);
            } catch (e) {
                showNotification('Ù…Ù„Ù JSON ØªØ§Ù„Ù Ø£Ùˆ ØºÙŠØ± ØµØ­ÙŠØ­.', 'error');
                return;
            }
           
            let importedIssues = [];
            if (parsedData.data && Array.isArray(parsedData.data)) {
                 importedIssues = parsedData.data;
            } else if (Array.isArray(parsedData)) {
                 importedIssues = parsedData;
            } else {
                showNotification('Ù…Ù„Ù JSON ØºÙŠØ± Ù…ØªÙˆØ§ÙÙ‚ Ø£Ùˆ ÙØ§Ø±Øº (Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø¯Ø§Ø®Ù„ Ù…ÙØªØ§Ø­ "data" ÙƒÙ‚Ø§Ø¦Ù…Ø©ØŒ Ø£Ùˆ Ù‚Ø§Ø¦Ù…Ø© Ù…Ø¨Ø§Ø´Ø±Ø©).', 'error');
                return;
            }

            importedIssues = importedIssues.filter(item => item.description && item.region && item.issueType && item.startTime); // Basic validation

            if (importedIssues.length > 0) {
                if (confirm(`Ø³ÙŠØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© (${issuesData.length} Ø³Ø¬Ù„) Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø© (${importedIssues.length} Ø³Ø¬Ù„). Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©ØŸ`)) {
                    issuesData = importedIssues.map(item => ({ // Ensure all items have an id and timestamps
                        ...item,
                        id: item.id || Date.now() + Math.random().toString(36).substr(2, 9),
                        timestamp: item.timestamp || new Date().toISOString(),
                        lastModified: item.lastModified || new Date().toISOString()
                    }));
                    saveData();
                    updateTable();
                    updateStats();
                    loadRegionsInFilter();
                    showNotification(`ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ ${importedIssues.length} Ø³Ø¬Ù„ Ø¨Ù†Ø¬Ø§Ø­.`);
                }
            } else {
                showNotification('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª ØµØ§Ù„Ø­Ø© (ØªØªØ·Ù„Ø¨ ÙˆØµÙØŒ Ù…Ù†Ø·Ù‚Ø©ØŒ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©ØŒ ÙˆÙˆÙ‚Øª Ø¨Ø¯Ø§ÙŠØ©) ÙÙŠ Ù…Ù„Ù JSON.', 'error');
            }
        }

        function importFromExcel(arrayBuffer) {
            const data = new Uint8Array(arrayBuffer);
            const workbook = XLSX.read(data, { type: "array", cellDates:true }); // cellDates helps with date objects
            const firstSheetName = workbook.SheetNames[0];
            const worksheet = workbook.Sheets[firstSheetName];
            const jsonData = XLSX.utils.sheet_to_json(worksheet, { raw: false }); // raw:false for formatted strings

            if (jsonData.length === 0) {
                showNotification('Ù…Ù„Ù Excel ÙØ§Ø±Øº Ø£Ùˆ Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª.', 'error');
                return;
            }
            
            const headerMapping = { // Keys are common Excel headers (allow flexibility), values are our internal keys
                "Ø§Ù„Ù…Ù†Ø·Ù‚Ø©": "region", "Region": "region",
                "Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©": "issueType", "Issue Type": "issueType",
                "Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©": "priority", "Priority": "priority",
                "Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ù…ØªÙˆØ§ØµÙ„": "contactPerson", "Contact Person": "contactPerson",
                "Ø§Ù„Ù…ÙØ¨Ù„Øº Ø¹Ù† Ø§Ù„Ù…Ø´ÙƒÙ„Ø©": "reportedBy", "Reported By": "reportedBy",
                "Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªØ£Ø«Ø±": "affectedSystem", "Affected System": "affectedSystem",
                "ÙˆÙ‚Øª Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ø´ÙƒÙ„Ø©": "startTime", "Start Time": "startTime",
                "ÙˆÙ‚Øª Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©": "endTime", "End Time": "endTime",
                "Ù…Ø¯Ø© Ø§Ù„ØªØ¹Ø·ÙŠÙ„ (Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚)": "duration", "Duration (min)": "duration",
                "Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø´ÙƒÙ„Ø©": "status", "Status": "status",
                "ÙˆØµÙ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©": "description", "Description": "description",
                "Ø§Ù„Ø­Ù„ Ø§Ù„Ù…Ø·Ø¨Ù‚": "solution", "Solution": "solution",
                "Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©": "notes", "Notes": "notes",
                "ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„": "timestamp", "Timestamp": "timestamp",
                "Ø¢Ø®Ø± ØªØ¹Ø¯ÙŠÙ„": "lastModified", "Last Modified": "lastModified"
            };
            
            const importedIssues = [];
            jsonData.forEach((row, i) => {
                const issue = { 
                    id: Date.now() + i + Math.random().toString(36).substr(2, 9) // Generate new ID
                };
                let hasRequiredFields = true;

                for (const excelHeader in row) {
                    const internalKey = Object.keys(headerMapping).find(key => excelHeader.trim().toLowerCase() === key.toLowerCase());
                    if (headerMapping[internalKey]) {
                         let value = row[excelHeader];
                         if ((headerMapping[internalKey] === 'startTime' || headerMapping[internalKey] === 'endTime' || headerMapping[internalKey] === 'timestamp' || headerMapping[internalKey] === 'lastModified') && value) {
                            let dateValue = value instanceof Date ? value : new Date(value);
                            if (!isNaN(dateValue.getTime())) {
                                issue[headerMapping[internalKey]] = `${dateValue.getFullYear()}-${String(dateValue.getMonth() + 1).padStart(2, '0')}-${String(dateValue.getDate()).padStart(2, '0')}T${String(dateValue.getHours()).padStart(2, '0')}:${String(dateValue.getMinutes()).padStart(2, '0')}`;
                            } else {
                                issue[headerMapping[internalKey]] = String(value); // Keep as string if not valid date
                            }
                        } else {
                            issue[headerMapping[internalKey]] = String(value);
                        }
                    }
                }
                
                // Check for minimum required fields for an issue to be valid
                if (!issue.description || !issue.region || !issue.issueType || !issue.startTime) {
                    hasRequiredFields = false;
                }
                // Add defaults if missing
                if (!issue.priority) issue.priority = "Ù…ØªÙˆØ³Ø·Ø©";
                if (!issue.contactPerson) issue.contactPerson = "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
                if (!issue.reportedBy) issue.reportedBy = "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
                if (!issue.status) issue.status = "Ù…Ø¹Ù„Ù‚Ø©";
                if (!issue.timestamp) issue.timestamp = new Date().toISOString();
                if (!issue.lastModified) issue.lastModified = new Date().toISOString();

                if (hasRequiredFields) {
                    importedIssues.push(issue);
                }
            });
            
            if (importedIssues.length > 0) {
                if (confirm(`Ø³ÙŠØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© (${issuesData.length} Ø³Ø¬Ù„) Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø© (${importedIssues.length} Ø³Ø¬Ù„ Ù…Ù† Excel). Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©ØŸ`)) {
                    issuesData = importedIssues;
                    saveData();
                    updateTable();
                    updateStats();
                    loadRegionsInFilter();
                    showNotification(`ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ ${importedIssues.length} Ø³Ø¬Ù„ Ù…Ù† Ù…Ù„Ù Excel Ø¨Ù†Ø¬Ø§Ø­.`);
                }
            } else {
                showNotification('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª ØµØ§Ù„Ø­Ø© ÙÙŠ Ù…Ù„Ù Excel. ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø£Ø¹Ù…Ø¯Ø© Ø¨Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø© (Ù…Ø«Ù„ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©ØŒ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©ØŒ ÙˆØµÙ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©ØŒ ÙˆÙ‚Øª Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ø´ÙƒÙ„Ø©) Ø£Ùˆ Ø£Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.', 'error');
            }
        }

        function clearAllData() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø© Ù…Ø­Ù„ÙŠØ§Ù‹ØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.')) {
                if (confirm('ØªØ£ÙƒÙŠØ¯ Ø£Ø®ÙŠØ±: Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ')) {
                    issuesData = [];
                    localStorage.removeItem('serverIssuesData'); // Also clear from localStorage directly
                    updateTable();
                    updateStats();
                    loadRegionsInFilter();
                    resetForm(); // Reset form as well
                    showNotification('ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­.');
                }
            }
        }

        function clearFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('filterRegion').selectedIndex = 0;
            document.getElementById('filterStatus').selectedIndex = 0;
            document.getElementById('filterPriority').selectedIndex = 0;
            updateTable();
            showNotification('ØªÙ… Ù…Ø³Ø­ Ø§Ù„ÙÙ„Ø§ØªØ±.');
        }
    </script>
<script>
function sendToGoogleSheet(formData) {
    fetch("https://script.google.com/macros/s/AKfycbwwTkZt0qynXgbaUNS0QE2o-sgrLGm5rbqWE20PKz0SAszaua1QIWx_ilWtY2Nx3dJOog/exec", {
        method: "POST",
        mode: "no-cors",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify(formData)
    })
    .then(() => {
        showNotification("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Google Sheet Ø¨Ù†Ø¬Ø§Ø­");
    })
    .catch((error) => {
        showNotification("âŒ ÙØ´Ù„ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª", "error");
        console.error("Google Sheet Error:", error);
    });
}

// ØªØ¹Ø¯ÙŠÙ„ Ø¨Ø³ÙŠØ· Ø¹Ù„Ù‰ handleSubmit Ù„ÙŠØ±Ø³Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
const originalHandleSubmit = handleSubmit;
handleSubmit = function(e) {
    e.preventDefault();
    calculateDuration();

    const formData = {
        region: document.getElementById('region').value,
        issueType: document.getElementById('issueType').value,
        priority: document.getElementById('priority').value,
        contactPerson: document.getElementById('contactPerson').value,
        reportedBy: document.getElementById('reportedBy').value,
        affectedSystem: document.getElementById('affectedSystem').value,
        startTime: document.getElementById('startTime').value,
        endTime: document.getElementById('endTime').value,
        status: document.getElementById('status').value,
        duration: document.getElementById('duration').value,
        description: document.getElementById('description').value,
        solution: document.getElementById('solution').value,
        notes: document.getElementById('notes').value,
        timestamp: new Date().toISOString(),
        lastModified: new Date().toISOString()
    };

    sendToGoogleSheet(formData);
    resetForm();
};
</script>
</body>
</html>